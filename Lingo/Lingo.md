# Lingo18

---

## Lingo的注释

> 以！开头，以;号结尾的语句是注释语句

## Lingo变量

1. lingo默认所有的变量都是大于等于0的，因此对于非负的条件不需要再次声明
2. 如果需要一个变量可以小于0， 则使用 **@free**函数，使其的作用域被定义为R
3. **lingo的变量名不区分大小写**
4. **lingo的标识符规则同C一致，由字母数字下划组成，且不能由数字开头**
5. lingo矩阵的索引是()

## 线性规划

- 一个线性规划中只含一个目标函数。**(两个或以上是多目标线性规划，lingo无法直接求解)**
- 求目标函数的最大值或最小值分别用max = ... 或 min = ... 来表示
- 线性规划和非线性规划的本质区别是目标函数是否线性，其余一致，故不需要区分

### 案例

> 某工厂有两条生产线，分别用来生产M和P两种型号的产品，利润分别为200元/个和300元/个，生产线的最大生产能力分别为每日100和120，生产线每生产一个M产品需要一个劳动日(1个工人工作八小时称为一个劳动日)进行调试、检测等工作，而每个P产品需要两个劳动日，该工厂工人每天共计能提供160个劳动日，加入原材料等其他条件不受限制
> 问：应如何安排生产计划，才能使获得利润最大？

- 数学模型为：
	- 目标函数：$max = 200x_1 + 300x_2$
	- 约束条件为:

$$
	\left\{\begin{matrix}
	{x_1 + 2x_2 \leq 160} \\
	{x_1 \leq 100} \\
	{x_2 \leq 120} \\
	{x_i \geq 0} & {i = 1, 2}
	\end{matrix}\right.
$$

- lingo求解

```lingo
max = 200 * x1 + 300 * x2;
x1 <= 100;
x2 <= 120;
x1 + 2 * x2 <= 160;

!结果为：
Variable    Value
x1          100.0000
x2          30.00000
```

## Lingo矩阵

### 矩阵语法

#### 一维矩阵的定义
- lingo18矩阵的元素初始值为0
- 以sets开始，以endsets结束
- 矩阵最开始的命名是随意取的
	- 在后面跟上/elem..elem/说明是几行几列的矩阵
	- 在大小后面使用: var, ... 说明定义了var等矩阵变量

```lingo
sets:
	factory /1..6/: a, b;
	plant /1..3/: x, y;
endsets
```

- 注意：
	- 前面的矩阵命名，是没有意义的，**但是，如果在类似于for循环中，需要得知矩阵的大小时，该命名相当于匿名的一个矩阵变量**

#### 一维矩阵的初始化

- 以data开始，以enddata结束

```lingo
data:
	a = 1, 2, 3, 4, 5, 6;
	b = 6.0, 5.0, 4.0, 3.0, 2.0, 1.0;
	x = 10. 20. 30;
enddata
```

- 注意：
	- 使用该初始化，**需要赋值的矩阵必须赋满，不可以只给个别元素赋值**

#### 二维矩阵的定义

- Lingo中，多维矩阵的定义是在一维矩阵的基础上的。**因此，必须先生成出多个一维矩阵**

```lingo
sets:
	factory /1..6/: a;
	plant /1..8/: b;
	Cooperation(factory, plant): x, y;
endsets;
```

- 注意：
	- 合成多维矩阵前面的命名是随意的，**最后才是真正的变量名**
	- 多维矩阵的shape，是由**一维矩阵的大小，以及顺序决定的**

#### 二维矩阵的初始化

```lingo
data:
	x = 6, 2, ..., 8
		4, 9, ..., 2
		...
		...
		5, 5, ..., 3;
```

- 注意：
	- 多维矩阵的初始化，**有多少行列，就写多少行列**
	- **每一行用回车换行，每一列用逗号间隔**

##### 例题1

> 已知模型如下，其中$a_i = i, i = 1, 2, ..., 5$，请编程求解

$max S$
$$
	s.t. 
	\left\{\begin{matrix}
	S = a_ix_i, & {i = 1,2,...,5} \\
	\sum_{i=1}^5{x_i=5000}
	\end{matrix}\right.
$$

###### 方法一：暴力枚举

$max S$

$$
	s.t.
	\left\{\begin{matrix}
	S = a_1x_1 \\
	S = a_2x_2 \\
	S = a_3x_3 \\
	S = a_4x_4 \\
	S = a_5x_5 \\
	x_1 + x_2 + x_3 + x_4 + x_5 = 5000
	\end{matrix}\right.
$$

```lingo
a1 = 1;
a2 = 2;
a3 = 3;
a4 = 4;
a5 = 5;

max = s;
s = a1 * x1;
s = a2 * x2;
s = a3 * x3;
s = a4 * x4;
s = a5 * x5;
x1 + x2 + x3 + x4 + x5 = 5000;

! 结果为:
Objective value:               2189.781

Variable    Value
 S         2189.781            0.000000
 X1        2189.781            0.000000
 X2        1094.891            0.000000
 X3        729.9270            0.000000
 X4        547.4453            0.000000
 X5        437.9562            0.000000
```

###### 方法二：循环求和

```lingo
sets:
	gc /1..5/: a, x;
endsets

data:
	a = 1, 2, 3, 4, 5;
enddata

max = s;
@for (gc(i) : s = a(i) * x(i));
@sum (gc(i) : x(i)) = 5000;

! 结果为: 
Objective value:          2189.781


Variable     Value        Reduced Cost
 S           2189.781     0.000000
 X( 1)       2189.781     0.000000
 X( 2)       1094.891     0.000000
 X( 3)       729.9270     0.000000
 X( 4)       547.4453     0.000000
 X( 5)       437.9562     0.000000

```

- 注意：
	- for循环和sum函数前面都需要带有@，**个人推断认为，lingo的函数和关键字都需要使用@来表明**
	- 同时，都需要用分号进行结束
	- for语句的语法为: @for (time : expression);
		- time: 就是循环迭代的次数
		- expression: 就是需要循环的表达式
	- sum语句的语法为: @sum (time: expression);
		- time: 就是循环迭代的次数
		- expression: 就是需要循环的表达式
	- **一维的遍历，可以省略索引，但是二维的时候不可省略，否则会有二义性**


- 注意：
	- 当创建矩阵之后，需要使用model和end将整个程序包容起来

##### 例题2

> 请编程求解一下模型，已知条件如下所示

- a = 60, 55, 51, 43, 41, 52
- d = 35, 37, 22, 32, 41, 32, 43, 38
- c = 
	- 6, 2, 6, 7, 4, 2, 5, 8
	- 4, 9, 5, 3, 8, 5, 8, 2
	- 5, 2, 1, 9, 7, 4, 3, 3
	- 7, 6, 7, 3, 9, 2, 7, 1
	- 2, 3, 9, 5, 7, 2, 6, 5
	- 5, 5, 2, 2, 8, 1, 4, 3

$min \ z = \sum_{i = 1}^6 \sum_{j = 1}^8 {c_{ij}·x_{ij}}$

$$
	s.t.
	\left\{\begin{matrix}
	\sum_{j=1}^8{x_{ij} \leq a_i} & {i=1,2,...,6} \\
	\sum_{i=1}^6{x_{ij}=d_j} & {j=1,2,...,8} \\
	x_{ij} \geq 0 & {i=1,..,6; j=1,...,8}
	\end{matrix}\right.
$$

```lingo
model:
	sets:
		factory /1..6/: a;
		plant /1..8/: d;
		coo(factory, plant): c, x;
	endsets

	data:
		a = 60, 55, 51, 43, 41, 52;
		d = 35, 37, 22, 32, 41, 32, 43, 38;
		c = 6, 2, 6, 7, 4, 2, 5, 8
			4, 9, 5, 3, 8, 5, 8, 2
			5, 2, 1, 9, 7, 4, 3, 3
			7, 6, 7, 3, 9, 2, 7, 1
			2, 3, 9, 5, 7, 2, 6, 5
			5, 5, 2, 2, 8, 1, 4, 3;
	enddata

	min = @sum(coo(i, j) : c(i, j) * x(i, j));
	! 或者
	min = @sum(factory(i) : @sum(plant(j) : c(i, j) * x(i, j)));
	@for(factory(i) : @sum(plant(j) : x(i, j)) <= a(i));
	@for(plant(j) : @sum(factory(i) : x(i, j)) = d(j));
end

! 结果为:
Objective value:                    664.0000

Variable           Value        Reduced Cost
X( 1, 1)        0.000000            5.000000
X( 1, 2)        19.00000            0.000000
X( 1, 3)        0.000000            5.000000
X( 1, 4)        0.000000            7.000000
X( 1, 5)        41.00000            0.000000
X( 1, 6)        0.000000            2.000000
X( 1, 7)        0.000000            2.000000
X( 1, 8)        0.000000            9.000000
X( 2, 1)        1.000000            0.000000
X( 2, 2)        0.000000            4.000000
X( 2, 3)        0.000000            1.000000
X( 2, 4)        32.00000            0.000000
X( 2, 5)        0.000000            1.000000
X( 2, 6)        0.000000            2.000000
X( 2, 7)        0.000000            2.000000
X( 2, 8)        0.000000            0.000000
X( 3, 1)        0.000000            4.000000
X( 3, 2)        11.00000            0.000000
X( 3, 3)        0.000000            0.000000
X( 3, 4)        0.000000            9.000000
X( 3, 5)        0.000000            3.000000
X( 3, 6)        0.000000            4.000000
X( 3, 7)        40.00000            0.000000
X( 3, 8)        0.000000            4.000000
X( 4, 1)        0.000000            4.000000
X( 4, 2)        0.000000            2.000000
X( 4, 3)        0.000000            4.000000
X( 4, 4)        0.000000            1.000000
X( 4, 5)        0.000000            3.000000
X( 4, 6)        5.000000            0.000000
X( 4, 7)        0.000000            2.000000
X( 4, 8)        38.00000            0.000000
X( 5, 1)        34.00000            0.000000
X( 5, 2)        7.000000            0.000000
X( 5, 3)        0.000000            7.000000
X( 5, 4)        0.000000            4.000000
X( 5, 5)        0.000000            2.000000
X( 5, 6)        0.000000            1.000000
X( 5, 7)        0.000000            2.000000
X( 5, 8)        0.000000            5.000000
X( 6, 1)        0.000000            3.000000
X( 6, 2)        0.000000            2.000000
X( 6, 3)        22.00000            0.000000
X( 6, 4)        0.000000            1.000000
X( 6, 5)        0.000000            3.000000
X( 6, 6)        27.00000            0.000000
X( 6, 7)        3.000000            0.000000
X( 6, 8)        0.000000            3.000000
```